# Base image with Ubuntu 22.04 (Jammy)
FROM ubuntu:22.04

# Set non-interactive frontend for apt
ENV DEBIAN_FRONTEND=noninteractive

# Add MongoDB official repository for mongosh
RUN apt-get update && apt-get install -y \
    wget gnupg lsb-release && \
    wget -qO - https://pgp.mongodb.com/server-7.0.asc | gpg --dearmor -o /usr/share/keyrings/mongodb-server-7.0.gpg && \
    echo "deb [ signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu $(lsb_release -cs)/mongodb-org/7.0 multiverse" \
        > /etc/apt/sources.list.d/mongodb-org-7.0.list

# Update & install packages
RUN apt-get update && apt-get install -y \
    sudo unzip zip git wget curl nano \
    software-properties-common ca-certificates gnupg2 apt-transport-https \
    build-essential cmake ninja-build pkg-config \
    python3 python3-pip python3-venv \
    php php-cli php-mbstring php-xml php-curl \
    openjdk-17-jdk maven \
    golang \
    clang gcc g++ \
    dotnet-sdk-7.0 aspnetcore-runtime-7.0 \
    nodejs npm \
    postgresql-client mysql-client redis-tools mongodb-mongosh \
    docker.io docker-compose \
    nvidia-cuda-toolkit \
 && apt-get clean && rm -rf /var/lib/apt/lists/*

# Install latest stable Node.js (includes Corepack)
RUN curl -fsSL https://deb.nodesource.com/setup_current.x | sudo -E bash - && \
    apt-get install -y nodejs && \
    corepack enable

# Create a non-root dev user
RUN useradd -ms /bin/bash devuser && echo "devuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
USER devuser
WORKDIR /home/devuser

# Optional: preinstall common global tools (adjust as needed)
RUN npm install -g yarn pnpm serve && \
    pip install --upgrade pip setuptools wheel && \
    pip install virtualenv

CMD ["bash"]