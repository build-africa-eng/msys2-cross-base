# Base image with CUDA support (Ubuntu 22.04 base)
FROM nvidia/cuda:12.3.1-base-ubuntu22.04

# Set noninteractive mode for apt
ENV DEBIAN_FRONTEND=noninteractive

# Update and install all core tools, compilers, interpreters
RUN apt-get update && apt-get install -y \
    # Essentials
    sudo unzip zip git wget curl nano lsb-release software-properties-common ca-certificates gnupg2 \
    build-essential cmake ninja-build pkg-config \
    # Python
    python3 python3-pip python3-venv \
    # PHP
    php php-cli php-mbstring php-xml php-curl \
    # Java
    openjdk-17-jdk maven \
    # Go
    golang \
    # C / C++
    clang gcc g++ \
    # .NET SDK
    apt-transport-https \
    dotnet-sdk-7.0 aspnetcore-runtime-7.0 \
    # JS + Corepack (pnpm/yarn)
    nodejs npm \
    # DB clients
    postgresql-client mysql-client redis-tools mongodb-mongosh \
    # Docker tools
    docker.io docker-compose \
    # GPU tools
    nvidia-cuda-toolkit \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Install Node.js LTS with Corepack support
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && corepack enable

# Set default shell
SHELL ["/bin/bash", "-c"]

# Set working directory
WORKDIR /workspace

# Allow Docker socket mounting (optional for docker-in-docker support)
VOLUME ["/var/run/docker.sock"]

# Default entrypoint
CMD ["bash"]